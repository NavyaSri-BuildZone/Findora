<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}Findora{% endblock %}</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>

<!-- Floating Blobs Background -->
<div class="bg-blobs">
  <div class="blob one"></div>
  <div class="blob two"></div>
  <div class="blob three"></div>
</div>

<!-- Page Wrapper -->
<div class="page-wrap">

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg bg-white bg-opacity-75 shadow-sm sticky-top">
    <div class="container py-2">

      <!-- Brand -->
      <a class="navbar-brand fw-bold" href="/">Findora âœ¨</a>

      <!-- Mobile Toggle -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Menu Items -->
      <div class="collapse navbar-collapse" id="navMenu">
        <ul class="navbar-nav ms-auto align-items-lg-center gap-2">

          <!-- Always Visible -->
          <li class="nav-item">
            <a class="nav-link fw-semibold" href="/">
              <i class="bi bi-house-heart"></i> Home
            </a>
          </li>

          <li class="nav-item">
            <a class="nav-link fw-semibold" href="/explore">
              <i class="bi bi-search-heart"></i> Explore
            </a>
          </li>

          <!-- Dark Mode Toggle Button -->
          <li class="nav-item">
            <button class="theme-btn" id="themeToggle" type="button">
              <i class="bi bi-moon-stars"></i> Mode
            </button>
          </li>

          <!-- If User Logged In -->
          {% if current_user.is_authenticated %}

            <!-- Report Buttons -->
            <li class="nav-item">
              <a class="nav-link fw-semibold" href="/report-lost">
                <i class="bi bi-exclamation-circle"></i> Report Lost
              </a>
            </li>

            <li class="nav-item">
              <a class="nav-link fw-semibold" href="/report-found">
                <i class="bi bi-check-circle"></i> Report Found
              </a>
            </li>

            <!-- My Claims -->
            <li class="nav-item">
              <a class="nav-link fw-semibold" href="/my-claims">
                <i class="bi bi-clipboard-check"></i> My Claims
              </a>
            </li>

            <!-- Finder Claims -->
            <li class="nav-item">
              <a class="nav-link fw-semibold" href="/finder-claims">
                <i class="bi bi-inboxes"></i> Finder Claims
              </a>
            </li>

            <!-- My Posts -->
            <li class="nav-item">
              <a class="nav-link fw-semibold" href="/my-posts">
                <i class="bi bi-journal-text"></i> My Posts
              </a>
            </li>

            <!-- Leaderboard -->
            <li class="nav-item">
              <a class="nav-link fw-semibold" href="/leaderboard">
                <i class="bi bi-trophy"></i> Leaderboard
              </a>
            </li>

            <!-- Admin ONLY -->
            {% if current_user.role == "admin" %}
            <li class="nav-item">
              <a class="nav-link fw-semibold" href="/admin/claims">
                <i class="bi bi-shield-lock"></i> Admin Claims
              </a>
            </li>

            <li class="nav-item">
              <a class="nav-link fw-semibold" href="/admin/reports">
                <i class="bi bi-flag"></i> Reports
              </a>
            </li>
            {% endif %}

            <!-- Greeting -->
            <li class="nav-item">
              <span class="nav-link text-muted">
                Hi, <b>{{ current_user.name }}</b> ðŸ‘‹
              </span>
            </li>

            <!-- Logout -->
            <li class="nav-item">
              <a class="btn btn-outline-custom" href="/logout">
                <i class="bi bi-box-arrow-right"></i> Logout
              </a>
            </li>

          <!-- If User NOT Logged In -->
          {% else %}

            <li class="nav-item">
              <a class="btn btn-outline-custom" href="/login">
                <i class="bi bi-person"></i> Login
              </a>
            </li>

            <li class="nav-item">
              <a class="btn btn-gradient" href="/register">
                <i class="bi bi-stars"></i> Register
              </a>
            </li>

          {% endif %}

        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container py-4">

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show glass-card" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </div>

</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Dark Mode Script -->
<script>
  function setTheme(theme){
    document.documentElement.setAttribute("data-theme", theme);
    localStorage.setItem("theme", theme);
  }

  const savedTheme = localStorage.getItem("theme");
  if(savedTheme){
    setTheme(savedTheme);
  }

  const btn = document.getElementById("themeToggle");
  if(btn){
    btn.addEventListener("click", () => {
      const current = document.documentElement.getAttribute("data-theme");
      if(current === "dark"){
        setTheme("light");
      }else{
        setTheme("dark");
      }
    });
  }
</script>

</body>
</html>
